---
layout: post
title: RxJava2 두번째, 간단한 프로젝트 생성해보기
category: [rxjava, reactive-programming]
author: hyungsun
image: assets/images/rxjava_1.png
---

## Index
---
- [RxJava2 첫 번째, RxJava에 관하여]({{site.url}}/RxJava2_1)
- RxJava2 두 번째, 간단한 프로젝트 생성해보기
- [RxJava2 세 번째, Retrofit 적용하기]({{site.url}}/RxJava2_3)

## Prologue
---
[RxJava 소개글]({{ site.url }}/RxJava2_1/){:target="_blank"}에서 언급했다시피 연습해볼 토이 프로젝트로 뭘 만들어 볼까 생각하다가 간단하게 온도계(?)를 만들면 좋겠다 싶어서 프로젝트를 생성했다. 

이 프로젝트에서 구현할 기능은 매우 간단하다.
- 주변 온도가 바뀜에 따라 메인 화면에 현재 온도를 보여준다. 
- 온도 값은 (귀찮으니)api를 쓰진 않고, 그냥 주기적으로 쓰레드를 돌려서 아무 값으로 바꾼다.

## Monologue
---

### 1. 프로젝트에 적용하기
`rxjava`를 안드로이드에 적용하기 위해서는 아래 dependencies들을 gradle파일에 추가해 주면 된다. version은 글 작성 날짜 기준으로 최신 릴리즈 버전을 적었다.

```gradle
dependencies {
  ...
  // RxJava2
  implementation 'io.reactivex.rxjava2:rxjava:2.1.9'
  implementation 'io.reactivex.rxjava2:rxandroid:2.0.2'
  ...
}
```
[`RxAndroid`](https://github.com/ReactiveX/RxAndroid){:target="_blank"}는 안드로이드 메인 스레드에서 작업을 수행하는 스케줄러를 제공해 준다. 이는 엑티비티의 생명주기 같은 안드로이드의 특수성때문에 추가한 사항이므로, 만약 여러분이 만들고자 하는 게 안드로이드 프로젝트가 아니라면 굳이 추가할 필요는 없다. 이제 `gradle sync`까지 하고나면 모든 준비가 끝난 것이다.

### 2. Core code
아래는 간단하게 구현해본 `MainActivity`코드이다. `RxJava`와 관련 없는 부분은 삭제했으니 그 부분이 궁금하시다면 [여기서](https://gist.github.com/poqw/139310db9f33505bc845e16608ebe1fe){:target="_blank"} 확인해 보시기 바란다. 프로젝트가 생성해준 코드외에 내가 작성한 코드는 모두 올려두었다. 참고로 이 프로젝트에서는 [데이터 바인딩](https://developer.android.com/topic/libraries/data-binding/index.html){:target="_blank"}을 사용했기 때문에 `gradle` 파일을 적절히 설정하지 않았다면 컴파일 에러가 날 것이다. 

```java
public class MainActivity extends Activity {
  private final TemperatureManager manager = new TemperatureManager();
  private Disposable disposable;

  @Override
  protected void onCreate(Bundle savedInstanceState) {
    // 생략...
    disposable = manager.updateEvent().subscribe(this::updateView);
  }

  @Override
  public void onDestroy() {
    super.onDestroy();
    disposable.dispose();
  }

  private void updateView(Temperature temperature) {
    binding.currentTemperatureView.setText(
        String.format("Current Temperature: %d", temperature.getDegree()));
  }
}
```
코드 자체는 엄청 간단하다. `onCreate`시점에 UI이벤트를 `subscribe`하고, `onDestroy` 시점에 `dispose` 하는 게 전부다. `.subscribe(this::updateView)`와 같은 문법은 java8에서 지원하는 문법인데, 구독할 때마다 들어오는 item 들을 `MainActivity`의 `updateView`가 받아서 처리하도록 하겠다는 뜻이다. `updateView`에서는 데이터가 언젠가는 들어오는 것이 보장되어 있으므로 이미 들어왔다고 가정하고 코드를 작성하면 된다. 

아래는 `TemperatureManager`코드이다. 
```java
class TemperatureManager {

  static class Temperature {
    private int currentTemperature;

    Temperature(int degree) {
      this.currentTemperature = degree;
    }

    int getDegree() {
      return this.currentTemperature;
    }
  }

  private PublishSubject<Temperature> subject = PublishSubject.create();

  void setTemperature(Temperature temperature) {
    subject.onNext(temperature);
  }

  Observable<Temperature> updateEvent() {
    return subject.subscribeOn(Schedulers.io())
        .observeOn(AndroidSchedulers.mainThread());
  }
}
```
`PublishSubject`가 생성하는 `subject`는 `Observable`을 UI이벤트와 연결지어서 사용하고 싶을 때 사용하는 녀석이라고 생각하면 된다. 차이점이 있다면 `Observable`은 내부에서만 데이터를 emit할 수 있는 반면, `subject`는 위 코드처럼 외부에서 데이터 주입(`setTemperature`에서 `onNext`로 데이터를 전달해주는 부분을 주목하자)이 가능하다. 

`updateEvent`에서 `subscribeOn`와 `observeOn`은 `subscribe`와 `observe`를 전담할 스레드를 지정하는 역할을 한다. UI 업데이트는 안드로이드 메인 쓰레드에서 실행해야 하므로 `AndroidSchedulers.mainThread()`를 지정해 주었다.

### 결과 화면

gif 로 만들기는 번거로워서 그냥 스크린 샷만 찍었다. 
실행시키면 온도가 3초마다 변경되고, 그걸 감지할 때마다 `TextView`가 업데이트 된다.

![]({{ site.url }}/assets/images/rxjava_1.png)


## Epilogue
---
사실 RxJava는 [`Retrofit`](http://square.github.io/retrofit/){:target="_blank"}과 엄청 합이 잘맞아서, 주로 RxJava + `Retrofit`형태로 많이 사용한다. 시간이 된다면 그것까지 연습해 보는 프로젝트를 만들어서 올려보도록 하겠다. 