---
layout: post
title: RooStory
category: [android, nginx, aws, node, javascript, my-project]
author: hyungsun
timelineText: My first android app (Incomplete)
startDate: 2017.2.13
endDate: 2017.5.21
image: assets/images/roostory.PNG
asset_media: assets/images/roostory.PNG
asset_caption: 
asset_credit: 
---

친구와 함께 태어나서 처음으로 안드로이드 앱을 만들어 보았다.  
하지만 결과적으론 로그인 후 글쓰기 기능이 전부인 토이 앱이 되어버렸다.  
이름은 캥거루의 Roo와 스토리 Story를 합쳐 만들었으나, 별 다른 의미는 없다.

### 개발 환경
#### 클라이언트
+ `Platform: Android`
+ `okhttp 3.2.0`
+ `gson 2.8.0`
+ `espresso 2.2.2`
#### 서버
+ `Platform: nginx 1.6.2 + Web Server(AWS) + TLS(openssl 1.0.1e-fips)`
+ `nodejs 7.4.0`
+ `MariaDB 10.0.24`
  
### 개발 기간
2017.2.13 ~ 2017.5.21

### 스크린 샷
![]({{ site.url }}/assets/images/roostory.PNG)

### 프로젝트 설명
#### 계획
여행이라는 카테고리에 집중한 소셜 네트워크 서비스를 제작하자는 것이 처음 계획이었으나, 개발 도중에 도저히 넘을 수 없는 스케일의 멋진 앱이 나와있는 것을 발견하고는 좌절하게 되었다. 지금 와서 생각해보면 이미 다른 앱이 나와있다고 해서 뛰어드는 걸 주저할 필요는 전혀 없는데, 너무 쉽게 포기한 것이 아닌가 싶어 조금 아쉽다.
결국 TLS를 입혀 보안 로그인 까지 구현된 상태에서 방향을 정하지 못하고 그대로 물거품이 되어버린 프로젝트이긴 하나, 내게는 그 의미가 나름대로 커서 포스팅 하게 되었다.

#### 클라이언트
클라이언트 중 서버와 통신하는 부분과 암복호화 모듈 개발을 진행했다.

#### 서버
서버는 대부분 혼자 개발을 맡아 진행하였고, 통신 간에 TLS를 입혔다. CA를 이용한 TLS구간을 지난 후 디비에 저장할 때 데이터 암호화는 `sha256` 으로, 다시 클라이언트와 통신할 때는 무결성을 위해 `base64` 인코딩을 적용하여 통신하는 방식을 채택했다.

`nodejs` 역시 이 프로젝트를 진행할 때 처음 써봤다.

#### 디자인
당시에도 허접해보였던 이 디자인은 지금 보니 속이 쓰라릴 정도다.



#### 어려웠던 점
###### Callback과 Closure?
클라이언트는 그냥 데이터를 보내고 원래 하던 프로세스를 돌면 되기 때문에 그리 어렵진 않았지만 서버는 생각보다 애를 먹었다. 동시 다발적으로 발생하는 이벤트 처리를 하기 위해선 익숙치 않던 `Callback` 이나 `Closure`에 대해 상당한 이해를 필요로 했기 때문이다.

###### 지옥의 TLS
TLS를 적용하기 전부터 굉장히 많은 어려움을 겪었다. TLS라는 개념 자체도 헷갈려 하던 시점이었기 때문이다.
Nginx가 요청을 리다이렉트를 해주는 것을 생각하지 못하고 계속 서버와 클라이언트 사이에 TLS를 놓는 바람에 무려 일주일이 넘어가도록 해결 못하고 삽질을 한 적도 있다. 정확히는 `Nginx`와 `nodejs`는 같은 `AWS` 인스턴스 에서 프로세스가 돌고 있었기 때문에 헷갈렸던 것이다. 결국 해결하고는 얼마나 기뻤는지 모른다.

또 TLS로 암호화된 통신을 하려면 CA를 클라이언트가 가지고 있어야 하는데 서버에서 어떻게 전달하지? 를 고민하다 `RSA`를 쓰려고 삽질을 그렇게나 했는데 알고보니 `RSA` 최대 데이터 사이즈 크기가 245바이트라서 마지막에 가서 실패하고 말았다. 결국 이 문제는 디바이스에 CA를 심어버리는 방식으로 해결했다. `RSA`를 쓸거라면 차라리 `AES`키를 암호화 한다음에 `AES`로 암호화해서 CA를 전달하는 것이 나았을 것이다.


