# Test driven development

## TDD하면서 지켜야 할 3가지 법칙

1. Failing test가 있을 때만 prod code를 작성하라.
2. Failing test code를 작성할 때는 최소한의 test 코드만 작성해라.
3. Failing test code가 있다면 그 코드가 pass하는 최소한의 코드만 작성해라.

## 어떤 테스트부터 작성해야 하는가?

**Simplest, but interesting**: 떠올릴 수 있는 가장 간결하면서도, 그러나 의미있는 테스트부터 작성한다.

## TDD의 순서

1. Start
2. Failing test 최소코드 작성
3. Passing prod 최소코드 작성
4. Refactoring (2로 다시 돌아간다, 만약 더 이상 생각나는 test case가 없다면 5로 간다)
5. Stop

주의 할 점: 4번 과정은 선택사항이 아니다. 만약 4번 과정을 무시할 경우 TDD를 했음에도 코드가 더럽다.

리펙토링을 한다는 것은 화장실을 이용한 뒤 손을 씻는 것에 비견될 만큼이나 자연스럽고 당연히 해야 하는 일임을 기억하자.

## Getting stuck

테스트 주도 개발을 하다가 막히는 경우가 있다.
이 경우, 작성자는 기존 코드를 지우고 다시 작성하지 않는 이상 테스트 케이스를 모두 통과하게 만들 수 없다는 생각에 부딪힌다.

주로 다음 두 가지 경우에 의해 발생한다.
- 잘못된 테스트를 작성했다
- prod code가 너무 구체적이다 (주로 Most simple, but interesting 원칙을 따르지 않으면 발생한다)

### 해결책

prod 코드를 지우고 처음부터 알고리즘을 작성한다.

## TDD 이점

- 스펙을 먼저 정하고 prod code구현하기 때문에 개발자로 하여금 코드를 작성할 때 쓸데 없는 잡생각을 없애준다.
- 테스트를 먼저 짜기 때문에 코드가 디커플링된다. 자연스럽게 좋은 설계을 얻을 수 있게 된다.

## UI Test?

UI는 너무 잦은 변경에 노출되어 있으므로 아주 구체적으로 테스트 코드를 작성하면 오히려 시간과 노력이 더 들어갈 수가 있다.

보통 UI Test는 생략하는 경우도 많고 작성하게 되더라도 매우 러프하게 작성한다.
러프하다는 의미는 리엑트 action 이 적절하게 트리거 되었는지, 어떤 텍스트를 가진 컴포넌트의 스타일이 원하는 대로 변경되었는지 정도의 의미라고 보면 된다.

Visual regression test로 대체하기도 한다. 이를 위한 라이브러리로는 대표적으로 [storybook](https://storybook.js.org/docs/guides/guide-react/)이 있겠다.

### TDD 연습하기

구글에 "TDD kata"를 검색해보자. kata 는 일본어로 품새라는 뜻인데, 이유는 모르겠지만 연습용 예제라는 의미로 쓰이는 듯 하다.

### 점진적 개선

TDD를 하다보면 Refactoring을 자연스레 하게 되고, Refactoring을 통해 모듈을 책임별로 분리하다 보면 자연스레 좋은 설계를 얻게 된다.
이를 보고 점진적 개선이라 한다.

이게 시사하는 바는, 처음부터 디자인 설계에 너무 목매지 말고 대략적인 설계만 칠판에 슥 그리고 치운 뒤, 직접 부딪혀 보며 구현하는 것이 훨씬 효율적이라는 것이다.
예쁜 다이어그램은 구현이 완료되었을 때에야 얻을 수 있으니까 말이다. 

실제로 이를 경험한 사람의 말을 들어보면, 다음과 같이 진행된다고 한다.

1. 통과하는 Test를 작성
2. 요구사항 대로 TDD를 통해 일단 구현
3. TDD안의 리펙토링을 통해 설계가 드러날 때까지 리펙토링
4. 아키텍쳐를 살피고, 책임 분리. 이미 이 단계에서 모든 동작은 성공적으로 수행되며, Test를 얻었으니 마음껏 변경이 가능하다.
5. 다시 리펙토링
6. 디자인을 표현하는 다이어그램 작성

# Etc

## Black-box testing & White-box testing

- White-box: 내부 소스코드를 테스트한다. if/while에 있는 조건문에 대한 테스트를 작성하고 구행 가능한 모든 경로를 추적한다.
- Black-box: 소프트웨어 내부 구조나 동작 원리를 모르는 상태에서 동작을 검사하는 방식, 올바른 입력과 올바르지 않은 입력을 주고 기대한대로 동작하는지 검사한다. 
